#!/usr/bin/env node
var Logger = require('../lib/dux/logger'),
    dux_cli = require('../lib/dux/cli'),
    dux, log = Logger.Logger();

// Handle debug flag externally
if (dux_cli.argv.debug) {
    log.info('Debugging ' + 'enabled'.green);
    Logger.debug();

    // Grab our new logger
    log = Logger.Logger();
}

dux = require('../lib/dux');
log.silly('Starting dux with ', dux_cli.argv);

// Start dux.
dux.start(dux_cli.argv, function start (error) {
    log.silly('Found error? ' + (error ? 'yes'.red : 'nope'.green));

    process.stdout.on('drain', function drain () {
        log.silly('stdout drained, exiting.');
        process.exit(error ? 1 : 0);
    });

    // Dux is finished.
    log.silly('Dux finished.');
});